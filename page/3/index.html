<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"coderfengyun.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://coderfengyun.github.io/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="article:author" content="coderfengyun">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://coderfengyun.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>

  <title>Hexo</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?35c1319c3dd486215e5e0046e151d588";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2017/12/28/%E4%B8%80%E8%87%B4%E6%80%A7%E7%B3%BB%E5%88%97%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/28/%E4%B8%80%E8%87%B4%E6%80%A7%E7%B3%BB%E5%88%97%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">一致性系列概述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-12-28 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-28T00:00:00+08:00">2017-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">分布式系统</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>日常编程中，接触了很多种类的一致性，这里希望把一致性中基本原理与原则做一个总结。</p>
<p>归纳的说，一致性描述的问题是，在什么情况下参与者可以观察到对方的变化，并以怎样的规范才能保证对于临界区的处理可控。即参与者A与B，当A <code>write</code> v时，B何时可以read到v的变化; A <code>write</code> v 与B <code>write</code> v 谁发生在前。编程者须遵循何种规范才能保证对于v的修改是符合意愿的。</p>
<p>一致性从最根本上讲，只包含两个原则：1、可见性原则；2、原子性原则；只要参与者满足上述两种原则同时满足上述两种原则，即可实现一致性保证。</p>
<p>为何称之为原则？主要是因为，参与者都遵守这样的原则之后，才可以使整个系统达到预期的一致性。</p>
<p>上述描述过于抽象，我们拆解一下：</p>
<p>1、可见性原则：<br>  即上述描述的，A <code>write</code> v时，B何时才能观察到。 举个例子, 当参与者是同一个进程中的多个线程时，可见性的表达常用volitale表达，即可见性原则总结为了happen before关系。happen-before则表明A <code>write</code> v happens-before B <code>read</code> v。<br>  可见性保证了什么呢？看个例子<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Visibility</span> &#123;</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">volatile</span> a=<span class="number">0</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">//in thread 1</span></span><br><span class="line">        a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//in thread 2</span></span><br><span class="line">        System.out.printlin(a);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>2、原子性原则：<br>  如上所述，可见性是保证对于一个值v的一致性的最基本且直观的方式，当希望保证对于一组值v1, v2, v3…保证一致性时只满足可见性原则还不够，还需要满足原子性原则。即我们希望能够支持，A <code>write</code> v1, v2, v3…，全部完成后，B <code>read</code> v1,v2,v3…时才可以读到改变。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2016/10/23/%E8%AE%B0%E4%B8%80%E6%AC%A1URLClassLoader%E9%97%AE%E9%A2%98%E8%BF%BD%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/10/23/%E8%AE%B0%E4%B8%80%E6%AC%A1URLClassLoader%E9%97%AE%E9%A2%98%E8%BF%BD%E6%9F%A5/" class="post-title-link" itemprop="url">Spring-Boot 1.4.0-RELEASE略显不负责任的版本----UrlClassLoader问题追查</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-10-23 00:00:00" itemprop="dateCreated datePublished" datetime="2016-10-23T00:00:00+08:00">2016-10-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">技术框架</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>场景描述：问题的发生来源一个工作中的问题，简要描述是在一个多module的maven project中，job module依赖server module完成工作，在intelliJ中执行良好，但是用maven package打包的时候，就会报找不到server module中对应的类。</p>
<p>于是乎，楼主开始了问题的排查。</p>
<p><strong>怀疑是maven的锅 </strong><br>首先，怀疑是本地maven问题，尝试了各种解决办法，如maven -U, 删除本地maven库中server module的相应版本等。</p>
<p><strong>察觉到问题关节 </strong><br>一通忙碌之后，楼主注意到报错的细节，不是找不到jar包，也不是server module的某一个类找不到，而是无论引用server module中的哪个类，package的时候都会报找不到响应的类。于是开始怀疑是不是server module的jar包有什么与众不同。</p>
<p><strong>对比问题jar与普通jar的不同之处 </strong><br>那么楼主便将server module的jar包unzip开，查看细节</p>
<p><em>有问题jar的结构</em><br>其中问题jar的包名是com.admin.server<br>jar–<br>     --BOOT-INF<br>     --META-INF<br>     --org<br>        --springframework<br>           --*</p>
<p><em>普通jar结构<br>普通jar的包名是com.admin.job<br>jar–<br>    --META-INF<br>    --com<br>       --admin<br>          --job<br>             \</em>.class</p>
<p>从中楼主比较出了不同，问题jar的主目录下并没有自己包名(com.admin.server)的目录，而普通的可依赖jar则有，那么是谁会修改这个jar的目录结构呢？</p>
<p><strong> spring-boot接锅</strong><br>我们仔细观察可以发现问题jar的主目录下多了一个BOOT-INF，于是把矛头指向了spring-boot，在观察一下server module的pom.xml，楼主感觉真実はいつも一つ (真相只有一个)</p>
<p><code><br>   <build><br>        <finalName>${project.artifactId}</finalName><br>        <plugins><br>            <plugin><br>                <groupId>org.springframework.boot</groupId><br>                <artifactId>spring-boot-maven-plugin</artifactId><br>                <version>1.4.0-RELEASE</version><br>                <executions><br>                    <execution><br>                        <goals><br>                            <goal>repackage</goal><br>                        </goals><br>                    </execution><br>                </executions><br>            </plugin><br>       …<br></code></p>
<p>从上述代码我们可以看出spring-boot做了个maven的plugin，在repackage时期的时候接手了打包过程。所以有理由怀疑这次问题是由于升级到了spring-boot 1.4.0-RELEASE引起的。</p>
<p>经过简单的搜索，便找到了stack overflow上得解答以及spring-boot自己的文档说明，<a href="http://docs.spring.io/spring-boot/docs/current/maven-plugin/examples/repackage-classifier.html" target="_blank" rel="noopener">spring-boot文档</a></p>
<p><strong> 然而intresting</strong><br>找到了问题后，稍一兴奋，便有一个问题萦绕在楼主心头，久久不能散去，classloader究竟是怎样在jar文件中查找类的呢？</p>
<p>阅读了一会URLClassLoader的源码，感觉不得要领，于是开始了写测试用例调试URLClassLoader的过程。</p>
<p>将上述问题jar作为全路径输入，查找其中的类名，debug走起</p>
<p><code><br>   @Test<br>    public void test() throws MalformedURLException {<br>        String pathname = “/<FOLDER_PATH>/target/admin-server-exec.jar”;<br>        try {<br>            Class&lt;?&gt; aClass = new URLClassLoader(new URL[]{FileURL.makeURL(pathname)}, null)<br>                    .loadClass(“com.admin.server.web.controller.AdminController.class”);<br>        } catch (ClassNotFoundException e) {<br>            e.printStackTrace();<br>        }<br>    }<br></code></p>
<p>不断跟踪深入，直到发现一处<br><code><br>esource getResource(String var1, boolean var2) {<br>            if(this.metaIndex != null &amp;&amp; !this.metaIndex.mayContain(var1)) {<br>                return null;<br>            } else {<br>                try {<br>                    this.ensureOpen();<br>                } catch (IOException var5) {<br>                    throw new InternalError(var5);<br>                }</p>
<pre><code>JarEntry var3 = this.jar.getJarEntry(var1);
</code></pre><p></code></p>
<p>以及getJarEntry的实现：<br><code><br>public ZipEntry getEntry(String name) {<br>        if (name == null) {<br>            throw new NullPointerException(“name”);<br>        }<br>        long jzentry = 0;<br>        synchronized (this) {<br>            ensureOpen();<br>            jzentry = getEntry(jzfile, zc.getBytes(name), true);<br>            if (jzentry != 0) {<br>                ZipEntry ze = getZipEntry(name, jzentry);<br>                freeEntry(jzfile, jzentry);<br>                return ze;<br>            }<br>        }<br>        return null;<br>    }<br></code></p>
<p>那么一切豁然开朗，从jar中查找一个类，最后的实现便是查找待寻找的名字是否在zip的相应位置，由此可见，被spring-boot重新打包之后的jar中找不到相应的类非常合理。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2016/03/19/Spring-Boot%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/03/19/Spring-Boot%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">SpringBoot哲学</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-19 00:00:00" itemprop="dateCreated datePublished" datetime="2016-03-19T00:00:00+08:00">2016-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">技术框架</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Spring-Annotation的哲学是要有开关：</p>
<ol>
<li><p>例如当你使用@ConfigurationProperties时，必须要搭配EnableConfigurationProperties </p>
</li>
<li><p>例如当你使用AutoConfiguration配置在META-INF中时，必须搭配使用@EnableAutoConfiguration</p>
</li>
<li><p>例如当在测试用例中要使用某些bean上的AOP方法生效（通过ASPECTJ实现的），则可以对改bean打上@EnableAspectJAutoProxy</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2016/01/12/refactoring-denpendency-module/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/12/refactoring-denpendency-module/" class="post-title-link" itemprop="url">重构包(模块)之间的依赖关系</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2016-01-12T00:00:00+08:00">2016-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">架构工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文翻译自Martin Fowler博客，<a href="http://martinfowler.com/articles/refactoring-dependencies.html" target="_blank" rel="noopener">原文地址</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2015/12/16/%E4%BC%A0%E8%AF%B4%E4%B8%AD%E7%9A%84mysql5.6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/12/16/%E4%BC%A0%E8%AF%B4%E4%B8%AD%E7%9A%84mysql5.6/" class="post-title-link" itemprop="url">传说中的MySQL 5.6</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-12-16 00:00:00" itemprop="dateCreated datePublished" datetime="2015-12-16T00:00:00+08:00">2015-12-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">存储系统</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>从哪说起，先从MySQL的官方文档说起。</p>
<p>当MySQL 5.5在全世界范围内广泛部署与使用之后，架构师们都在翘首以盼，期待着MySQL 5.6的将临。MySQL 5.6在MySQL 5.5的基础上开发完成。</p>
<p>今年MySQL的会议上，会听到如下的主题：</p>
<ul>
<li>优化器全面提高性能</li>
<li>InnoDB提高事务吞吐</li>
<li>全新的NoSQL memcached APIs</li>
<li>查询和超大表分区优化</li>
<li>replication多方面提高</li>
<li>PERFORMANCE_SCHEMA 提供了更多的性能监控数据</li>
</ul>
<p>注1：MySQL的实现分为两层，即服务器层（后文简称为server）和存储引擎层（storage engine）<br>注2：MySQL的索引遍历是在存储引擎层实现。</p>
<p>##<strong><em> 优化器全面提高性能 </em></strong></p>
<p>###<strong> 索引条件下推到存储引擎</strong><br>将where子句中的处理更多的转移到存储引擎处理。相比取出完整行后再使用where子句评估，ICP(Index Condition Push-down)将这些where子句发送到存储引擎，这样存储引擎可以根据索引组(index tupples)来修剪结果集。从而，降低了对主索引的IO开销，降低了server与存储引擎之间的传输开销。这项特点在innodb，MyISAM，NDCluster引擎上都有实现。</p>
<p>ICP是一项优化，在MySQL从一个有索引的表取数据时生效。没有ICP，存储引擎将会根据索引来定位所需要的行，然后把这些行完整返回给server，在server出对这些行验证where子句（where子句部分，如果验证不通过，将会把这些行丢弃）。一旦启用了ICP，如果where子句中有一部分条件可以只使用了索引中的列，（MySQL）server将会把这一部分（只涉及索引部分的where子句）下推到存储引擎层。存储引擎将会根据索引中的数据来判定这些下推的where子句，只有（index中的数据）满足这些（下推的）条件时才会从主表中真正读取这些行。ICP可以减少存储引擎访问主表的次数，同时还可以减少MySQL Server访问存储引擎的次数。</p>
<p>当需要访问整个行的完整数据是，ICP优化对于range，ref，eq_ref和ref_or_null等访问方式有效。这种策略对于InnoDB和MyISAM类型的表都有效。（注意：在MySQL 5.6中的partitioned 表不支持ICP.）对于InnoDB表来说，ICP只对二级索引（非主键索引）有效。ICP的目标是检索整行扫描读的数量，以此减少IO操作。对于InnoDB聚合索引来说，整行记录已经被读入InnoDB的缓存中。在这种情况下，使用ICP起不到减少IO的作用。</p>
<p>为了看出这项优化是怎么工作的，首先考虑一下在没有ICP时，索引扫描是怎样进行的。</p>
<ol>
<li>得到下一行：首先，读取索引中的下一个元组，然后使用该元组到主表中定位和读取整行数据。</li>
<li>验证where子句中（应用在该表上）的条件，根据验证结果决定接受或者拒绝改行。</li>
</ol>
<p>当启用了ICP时，索引扫描的过程会是这样：</p>
<ol>
<li>获取索引中的下一个元组（而不是获取整行数据）。</li>
<li>验证where子句中（应用在该表上）的条件中的一部分（可以用该索引判定的部分），如果条件不满足，继续验证索引中的下一个元组。</li>
<li>如果条件满足了，使用该索引元组来定位和读取完整行记录。</li>
<li>验证where字句中（应用在该表上）的剩余部分，根据验证结果接受或者拒绝改行。</li>
</ol>
<p>当ICP被启用时，Explain中的Extra列中将展示”Using index condition”. 它不会显示”Index only”，因为当完整行记录必须被读取（不管是判断where条件还是返回select需要数据）时就不是只使用Index了。</p>
<p>假设，我们有一张表包含了人和他们的地址，并且该表拥有一个索引index(zipcode, lastname, firstname). 如果我们知道一个人的zipcode值，但是并不确定他的姓，我们可以这样查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> people</span><br><span class="line">  <span class="keyword">WHERE</span> zipcode=<span class="string">'95054'</span></span><br><span class="line">  <span class="keyword">AND</span> lastname <span class="keyword">LIKE</span> <span class="string">'%etrunia%'</span></span><br><span class="line">  <span class="keyword">AND</span> address <span class="keyword">LIKE</span> <span class="string">'%Main Street%'</span></span><br></pre></td></tr></table></figure>
<p>MySQL可以根据zipcode=’95054’使用索引扫描people表。而index中剩余的部分(lastname like ‘%etrunia%’)不能被用来限制需要扫描的行数，所以没有ICP，这条查询将必须取得所有满足zipcode=’95054’完整行记录。</p>
<p>如果启用了ICP，MySQL将会在读取完整行记录之前检查(lastname like ‘%etrunia%’)。这样就避免了对于不满足lastname条件的行的完整行记录扫描。</p>
<p>ICP默认打开；可以使用optimizer_switch系统变量来设置index_condition_pushdown参数。</p>
<p>###<strong> 多范围读(Multi-Range Read，MRR) </strong><br>直到你有足够的SSD之前，从磁盘中顺序读都会比随机读要快。对于二级索引（非主键索引），硬盘上索引条目的顺序和完整行记录所在的硬盘块的顺序是不一致的。与其是通过一些列无序的读磁盘来获取完整的行记录，MRR扫描一个查询中的一个或多个索引范围，然后所得的索引元组按照相应的完整行数据所在的磁盘块排序。然后使用更大的顺序IO的请求读取这些磁盘块。这项优化对范围索引扫描以及在索引列上的equi-join有效。（考虑InnoDB外键。）对于所有的存储引擎都有效。</p>
<p>通过在二级索引上的范围扫描来读取数据，当主表很大并且没有在存储引擎的缓存中时，会造成对主表大量的随即磁盘读。通过磁盘块交换MMR优化，MySQL试图减少范围扫描造成的随机磁盘读取次数，主要通过首先只扫描索引，然后手机相关行的键（主键？）。随后这些键被排序，最后这些完整行记录按照主键的顺序被读取出来。MRR的主要目的是减少硬盘随机读，代之以更顺序的方式扫描基表。</p>
<p>MRR读优化提供了一下好处：</p>
<ol>
<li>MRR使得数据行可以被顺序读取而不是按照索引顺序随机读取。server获取了满足查询条件的索引元组，按照行数据ID（主键）的顺序排序，然后使用这些排序后的元组来顺序的获取数据。这使得获取数据更加的有效和低耗。</li>
<li>MRR使得可以对需要访问索引并通过索引元组来访问完整行记录的请求进行批量处理。MRR遍历一系列的索引范围来获取满足条件的索引元组(类似于tcp拥塞控制中，把较小的包累计后一起发送)。不断的收集索引元组，当累积到一定量时，（这些元组）用来到主表中读取数据行。</li>
</ol>
<p>在以下的场景中，应用MRR优化可能会带来利好</p>
<p>####Senario A: MRR可以被用于InnoDB和MyISAM表的索引范围查询和equi-join操作。</p>
<ol>
<li>一部分的索引元组在缓存中累积。</li>
<li>缓存中的元组按照ID排序。</li>
<li>按照拍好序的顺序访问主表中的数据行。</li>
</ol>
<p>####Senario B: MRR可以被用于NDB表，用于多范围索引扫描以及通过一个属性进行equi-join</p>
<ol>
<li>一部分的多个范围索引的元组，或是单个索引范围的元组，当查询提交时，在中心节点的缓存中累积。</li>
<li>这些范围被发送到执行节点上用以访问数据行。</li>
<li>这些被访问的行被打成协议包，回传给中央节点。</li>
<li>（中心节点）接收到包含数据行的协议包后，把它们放在缓存中。</li>
<li>数据被从缓存中读取。</li>
</ol>
<p>当MRR被使用时，当MRR被使用时，EXPLAIN的Extra列将展示<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using MRR</span><br></pre></td></tr></table></figure><br>当查询结果不需要整行数据时，InnoDB和MyISAM不会使用MRR。原因是，有可能索引中信息足够用来构造查询结果（即覆盖索引），在这样的情况下，MRR没有任何增益。</p>
<h5 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h5><p>在下面的栗子中，MRR会被使用（假设有一个索引INDEX(key_part1, key_part2)）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t</span><br><span class="line">   <span class="keyword">WHERE</span> key_part1 &gt;= <span class="number">1000</span> <span class="keyword">AND</span> key_part1 &lt; <span class="number">2000</span></span><br><span class="line">   <span class="keyword">AND</span> key_part2 = <span class="number">10000</span>;</span><br></pre></td></tr></table></figure>
<p>索引中包含(key_part1, key_part2)元组的值，按照”首先按照key_part1排序，再按照key_part2排序”的规则排序。</p>
<p>如果没有MRR，一次索引扫描将覆盖所有的keypart1从1000到2000的元组，不管key_part2在这些元组中的值是不是10000<a href="个人对这个解释存疑。">^footnote1</a>。这样的扫描出的元组中key_part2的值不一定是10000。</p>
<p>如果启用了MRR，扫描会被分解成多个范围，每个范围包含key_part1单个的一个值。每个这样的扫描都只需过滤处理那些key_part2的值为10000的元组。MRR使得索引扫描的元组数量大大减少。</p>
<p>用范围标记表示（不使用MRR的查询），不使用MRR的扫描必须要验证这样的索引区间[{1000, 10000}, {2000, INT_MIN}][^footnote2]。这样扫描结果可能会包含许多key_part2不为10000的元组。<br>然而MRR扫描，则验证多个单点区间[{1000, 10000}], [{1001, 10000}]…, [{2000, 10000}]，这样扫描得到的索引元组将只包含key_part2=10000的部分。</p>
<p>两个optimizer_switch系统变量标志为可以提供接口来使用MRR优化。mrr标志位控制MRR是否启用。如果mrr被启用了（on），mrr_cost_based标志位将控制优化其是否要根据开销来选择使用使用MRR(ON)，<br>还是只要能使用MRR就是用它（OFF）。mrr，mrr_cost_based都是默认打开的（on）。</p>
<p>对于MRR，存储引擎使用read_rnd_buffer_size系统变量的值作为能够申请多少内存(用于MRR)的指导值。引擎将根据read_rnd_buffer_size来决定将单次处理分割成多少个range。</p>
<p>##…未完待续</p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<p><strong> 文件排序优化（File Sort Optimization, FSO） </strong><br>对于组合了ORDER BY non_index_column(无索引列) 与LIMIT x的查询，本特性，在X列的内容可以被装入排序buffer中时，会加速排序。对于所有的存储引擎都生效。</p>
<p><strong> Innodb优化 </strong><br>MySQL 5.6以innodb作为默认的存储引擎，从MySQL 5.5开始就是这样。</p>
<p><strong><em> 存储优化器状态</em></strong><br>提供了更精确的InnoDB索引统计，并且在MySQL重启之后不会消失。InnoDB提前通过对索引的一部分进行采样计算统计，这些统计会帮助优化器决定在一个查询中要选择使用哪个索引。这些统计在MySQL重启后不会丢失。而不是在重启或发生一些运行中事件时重新计算。更加准确的统计会提高查询性能，并且存储方面会保持查询性能的稳定。这项特性被innodb_analyze_is_persistent, innodb_stat_persistent_sample_pages以及innodb_stats_transient_sample_pages等配置项控制。当这项存储状态特性被激活，这些统计信息只会在明确的对表调用ANALYZE_TABLEi。</p>
<h1 id="新的INFOMATION-SCHEMA表"><a href="#新的INFOMATION-SCHEMA表" class="headerlink" title=" 新的INFOMATION_SCHEMA表"></a><strong><em> 新的INFOMATION_SCHEMA表</em></strong></h1><p>[^footnote2]: 原因是在SQL的比较中组合索引的比较逻辑先以第一个key为主，然后在比较第二个，依次类推。例如{1001, 0} &gt; {1000, 10000}</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>05540260346b54dcac9d41b4fac10bab58d0e736</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2015/07/16/Replacing-The-Exceptions-With-Notification-In-Validations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/07/16/Replacing-The-Exceptions-With-Notification-In-Validations/" class="post-title-link" itemprop="url">在验证程序输入时使用Notification来替代Exception</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-07-16 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-16T00:00:00+08:00">2015-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%87%8D%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">重构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文翻译自Martin Fowler博客，<a href="http://martinfowler.com/articles/replaceThrowWithNotification.html" target="_blank" rel="noopener">原文地址</a></p>
<p>如果你要验证一些输入数据，通常不应该选择用Exception的方式来表明验证失败。我想仔细的描述如何使用Notification模式来重构这样的代码。</p>
<p>目录：<br><em>什么时候使用此项重构
</em>从哪里开始<br><em>构建一个Notification
</em>分解检验方法<br><em>验证数字
</em>验证日期<br>*缩减调用栈</p>
<p>我最近正在琢磨一些处理传入Json消息的验证代码。就像下面这个。<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> void check()&#123;</span><br><span class="line">  <span class="keyword">if</span>(date == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date is missing"</span>);</span><br><span class="line">  LocalDate parsedDate;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    parsedDate = LocalDate.parse(date);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"Invalid format for date"</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(parsedDate.isBefore(LocalDate.now())) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date cannot be before today"</span>);</span><br><span class="line">  <span class="keyword">if</span>(numberOfSeats == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">  <span class="keyword">if</span>(numberOfSeats &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(JAVA代码)</span><br></pre></td></tr></table></figure><br>这是处理数据验证的通用方式。在一些数据上执行一系列的检查。如果任何一个检查失败了，就抛出一个带有错误信息的异常。</p>
<p>这样的方式存在一些问题。首先，在这样的场景下使用Exception让我不爽。异常表明发生了一些超出程序预期的事情。但是，如果你对外来输入进行了检查，就说明你对一些信息不合法是有预期的。如果这样的失败是可以预期的，那么就不应该使用异常。</p>
<p>其次，程序只能检测出一个错误，但是最好是能够报告输入参数的所有问题。这样客户端可以将所有的错误都展示给用户，而不是让用户一遍一遍的尝试。</p>
<p>我比较倾向的报告验证方式是像后文描述的Notification模式。一个Notification收集错误，每个验证失败都会想notification增加一个错误。一个验证方法返回一个Notification，让你可以向用户交付更多信息。一个简单的例子如下。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private void validateNumberOfSeats(Notication note)&#123;</span><br><span class="line">  if(numberOfSeats &lt; 1) note.addError(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">  //more<span class="built_in"> check </span>like this</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以用一个简单的调用aNotification.hasErrors()来检查是不是有错误。Notification的其他方法可以包含更多详细的错误信息。</p>
<p><img src="/images/ReplaceThrowExceptionWithNotification/fromExceptionToNotification.png" alt="代码转变"></p>
<p>#<strong><em> 何时使用这项重构 </em></strong><br>我需要强调，我不是建议从你的代码中删除所有的Exception。异常是处理异常行为并使之与正常逻辑流分离的好方式。这个重构方式，在一些特征表明异常并非是异常性的时候，才比较合适，因此我们需要在主要的逻辑流中来处理。我上面举的例子，就是一个典型的代表。</p>
<p>一个《Pragmatic Programmers》提供的比较有用的经验是：<br><strong><em>我们相信异常在程序的正常流程里应该是很少使用的。异常应该表征不可预测的行为。假设一个没被抓住的异常是你的程序崩溃了，那么问问你自己，“如果我去掉了所有的异常处理器，程序还能否运行”，如果答案是NO，那么也许是在不应该使用Exception的地方使用了Exception。                    – David Thomas and Andy Hunt </em></strong></p>
<p>这样的一个重要结果是是否要使用异常来处理特定的任务是要看所处环境的。所以，就像《Pragmatic Programmers》继续解释的那样，读取文件时如果文件不存在，抛不抛出异常要根据具体情况分析了。如果要读的文件是一个众所周知（默认一定存在，例如unix环境下的/etc/hosts），我们将假设次文件存在，如果此时文件不存在，那么此时抛出异常就是合理的。然而，如果你要读的文件是用户通过command line输入的，那么应该认为这个文件有可能不存在，并应使用其他的机制（而不是异常），一个可以表征这个错误本质上不是异常状况的方式。    </p>
<p>还有一种情况会比较适合食用异常来验证失败。例如，当使用的数据，在之前的流程已经被验证过，但是想要再次检查以防止衰代码引入脏数据。</p>
<p>这篇文章是关于在验证（用户）原始输入时，使用Notification替代Exception。有可能在其他场景下，用Notification也比使用Exception更合适，但是我还是专注于这个问题（校验用户的原始输入）。</p>
<p>#<strong><em> 起点 </em></strong></p>
<p>到现在还没有给个例子，只是由于我对各种形态的代码都很感兴趣（一时无法取舍）。但是如果我们聊的再深入些，我就必须得对某一种（代码形态）深入探讨了。我想用这样一个例子，即预定电影院座位时的JSON信息的处理。代码是在一个预定请求类中，(这个类）是从JSON中（使用gson）提取出来的。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gson.from<span class="constructor">Json(<span class="params">jsonString</span>, BookingRequest.<span class="params">class</span>)</span></span><br></pre></td></tr></table></figure>
<p>这个预定请求中，我们需要检查的只有两个域，预定的时间和预定的座位数。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">BookingRequest</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Integer numberOfSeats;</span><br><span class="line">  <span class="keyword">private</span> String date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>验证代码既是向上面展示的那样：<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> void check()&#123;</span><br><span class="line">  <span class="keyword">if</span>(date == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date is missing"</span>);</span><br><span class="line">  LocalDate parsedDate;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    parsedDate = LocalDate.parse(date);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"Invalid format for date"</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(parsedDate.isBefore(LocalDate.now())) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date cannot be before today"</span>);</span><br><span class="line">  <span class="keyword">if</span>(numberOfSeats == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">  <span class="keyword">if</span>(numberOfSeats &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(JAVA代码)</span><br></pre></td></tr></table></figure></p>
<p>#<strong><em> 构建一个通知 </em></strong><br>为了使用通知，你必须穿件一个通知对象。一个通知可以非常简单，有时候字符串List就可以玩这个把戏。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; notification = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (numberOfSeats &lt; <span class="number">5</span>) notification.add(<span class="string">"number of seats too small"</span>);</span><br><span class="line"><span class="comment">// do some more checks</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// then later…</span></span><br><span class="line"><span class="keyword">if</span> ( ! notification.isEmpty()) <span class="comment">// handle the error condition</span></span><br></pre></td></tr></table></figure>
<p>尽管阿哥简单的List实现了非常轻量的Notification模式，我通常喜欢做的更多些，创建一个简单的类。<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Notification</span> &#123;</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;<span class="keyword">String</span>&gt; errors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addError</span><span class="params">(<span class="keyword">String</span> message)</span> </span>&#123; errors.add(message); &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ! errors.isEmpty();</span><br><span class="line">  &#125;</span><br><span class="line">  …</span><br></pre></td></tr></table></figure><br>通过使用一个类，可以让我的意图更加明确，（代码的）读者不需要去脑补我的意图和我的实现之间的映射关系。</p>
<p>#<strong><em> 分解检查方法 </em></strong><br>第一步是将检查方法分解为两个部分，一个内含的部分只会处理通知，并不抛出异常;一个外部部分会维持检查当前检查方法的行为，既是抛出一个异常来表明验证失败。</p>
<p>第一步，用Extract Method将检查相关(check方法)的逻辑抽离到一个新的validation方法中<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookingRequest</span>…</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">void</span> <span class="title">check</span>() </span>&#123;</span><br><span class="line">    validation();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> void validation() &#123;</span><br><span class="line">    <span class="keyword">if</span> (date == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date is missing"</span>);</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedDate = LocalDate.parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (DateTimeParseException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"Invalid format for date"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.isBefore(LocalDate.now())) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date cannot be before today"</span>);</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来，我会把validation的返回值改为返回一个notification。<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookingRequest</span>…</span></span><br><span class="line"><span class="class">  <span class="title">public</span> <span class="title">Notification</span> <span class="title">validation</span>() </span>&#123;</span><br><span class="line">*** Notification note = <span class="keyword">new</span> <span class="type">Notification</span>();</span><br><span class="line">    <span class="keyword">if</span> (date == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date is missing"</span>);</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedDate = LocalDate.parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (DateTimeParseException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"Invalid format for date"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.isBefore(LocalDate.now())) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"date cannot be before today"</span>);</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats &lt; <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalArgumentException</span>(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">*** <span class="keyword">return</span> note;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>我现在可以检查notification，如果有错误的话，可以抛出一个异常了。<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">BookingRequest</span>…</span><br><span class="line">  <span class="symbol">public</span> <span class="symbol">void</span> <span class="symbol">check</span>() &#123;</span><br><span class="line">*** <span class="keyword">if</span> (validation().hasErrors()) </span><br><span class="line">***   throw new IllegalArgumentException(validation().errorMessage());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>我把validation方法置为public，因为我希望更多的调用者可以使用这种方式来验证，而不是check方法。</p>
<p>在这点上，我并没有改变代码的行为，notification不会遗漏任何的错误。但是我已经准备好使用notification来替代异常了。</p>
<p>在我继续之前，我必须说一些有关错误信息的事。当我们进行一次重构时，原则是避免对可观测的行为产生影响。很明显地，抛出相应的异常是外部程序所观测的行为。但是他们（外部程序）对错误信息关注到什么程度呢？notification会最终将多个错误收集起来，汇总称为一个单独的信息，如下：<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">Notification</span>…</span><br><span class="line">  <span class="symbol">public</span> <span class="symbol">String</span> <span class="symbol">errorMessage</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> errors.stream()</span><br><span class="line">      .collect(Collectors.joining(<span class="string">", "</span>));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>但是，如果高层程序依赖于“获取第一个错误的信息”，那么就会产生问题。别人没有把这个事搞砸，不代表我不会把他搞砸。</p>
<p>#<strong><em> 验证数字 </em></strong><br>当前要做的就是把第一个验证替换掉<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class BookingRequest…</span><br><span class="line">  public Notification validation() &#123;</span><br><span class="line">    Notification<span class="built_in"> note </span>= new Notification();</span><br><span class="line">*** <span class="keyword">if</span> (date == <span class="literal">null</span>) note.addError(<span class="string">"date is missing"</span>);</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    try &#123;</span><br><span class="line">      parsedDate = LocalDate.parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      throw new IllegalArgumentException(<span class="string">"Invalid format for date"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.isBefore(LocalDate.now())) throw new IllegalArgumentException(<span class="string">"date cannot be before today"</span>);</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats == <span class="literal">null</span>) throw new IllegalArgumentException(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats &lt; 1) throw new IllegalArgumentException(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">    return note;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>一个理所当然的改变，但是并不好，因为改变了代码行为。如果我们将一个null的date传入下面的处理过程，会引起NPE，这并不是我们需要的异常。<br>所以，一个不那么直观，但是更有效的方式是后退一步(即从后向前处理)。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class BookingRequest…</span><br><span class="line">  public Notification validation() &#123;</span><br><span class="line">    Notification<span class="built_in"> note </span>= new Notification();</span><br><span class="line">    <span class="keyword">if</span> (date == <span class="literal">null</span>) throw new IllegalArgumentException(<span class="string">"date is missing"</span>);</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    try &#123;</span><br><span class="line">      parsedDate = LocalDate.parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      throw new IllegalArgumentException(<span class="string">"Invalid format for date"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.isBefore(LocalDate.now())) throw new IllegalArgumentException(<span class="string">"date cannot be before today"</span>);</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats == <span class="literal">null</span>) throw new IllegalArgumentException(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">*** <span class="keyword">if</span> (numberOfSeats &lt; 1) note.addError(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">    return note;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>前面的检查，是一个null的检查，所以我们需要使用条件判断来避免NPE。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class BookingRequest…</span><br><span class="line">  public Notification validation() &#123;</span><br><span class="line">    Notification<span class="built_in"> note </span>= new Notification();</span><br><span class="line">    <span class="keyword">if</span> (date == <span class="literal">null</span>) throw new IllegalArgumentException(<span class="string">"date is missing"</span>);</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    try &#123;</span><br><span class="line">      parsedDate = LocalDate.parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      throw new IllegalArgumentException(<span class="string">"Invalid format for date"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.isBefore(LocalDate.now())) throw new IllegalArgumentException(<span class="string">"date cannot be before today"</span>);</span><br><span class="line">*** <span class="keyword">if</span> (numberOfSeats == <span class="literal">null</span>) note.addError(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">*** <span class="keyword">else</span> <span class="keyword">if</span> (numberOfSeats &lt; 1) note.addError(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">    return note;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>我们看到下一个价差涉及到了不同的域。我们必须要给之前的重构引入条件判断了，我开始考虑validation方法开始变的太过复杂并且可以对他做一些肢解。所以我把数字验证部分抽离了出来。<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> BookingRequest…</span><br><span class="line">  public Notification validation<span class="literal">()</span> &#123;</span><br><span class="line">    Notification note = <span class="keyword">new</span> <span class="constructor">Notification()</span>;</span><br><span class="line">    <span class="keyword">if</span> (date<span class="operator"> == </span>null) throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"date is missing"</span>)</span>;</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedDate = <span class="module-access"><span class="module"><span class="identifier">LocalDate</span>.</span></span>parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"Invalid format for date"</span>, <span class="params">e</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.is<span class="constructor">Before(LocalDate.<span class="params">now</span>()</span>)) throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"date cannot be before today"</span>)</span>;</span><br><span class="line">*** validate<span class="constructor">NumberOfSeats(<span class="params">note</span>)</span>;</span><br><span class="line">    return note;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> void validate<span class="constructor">NumberOfSeats(Notification <span class="params">note</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats<span class="operator"> == </span>null) note.add<span class="constructor">Error(<span class="string">"number of seats cannot be null"</span>)</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (numberOfSeats &lt; <span class="number">1</span>) note.add<span class="constructor">Error(<span class="string">"number of seats must be positive"</span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>看看抽离出的对数字的验证方法，我并不喜欢这种结构。在验证的时候，我不喜欢用if-then-else块，因为很容易会导致代码杂糅在一起。我选择流畅的短路代码，此时我们可以使用哨兵检测来替代嵌套的判断条件。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">BookingRequest</span>…</span><br><span class="line">  <span class="symbol">private</span> <span class="symbol">void</span> <span class="symbol">validateNumberOfSeats</span>(<span class="symbol">Notification</span> <span class="symbol">note</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats == <span class="literal">null</span>) &#123;</span><br><span class="line">      note.addError(<span class="string">"number of seats cannot be null"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (numberOfSeats &lt; <span class="number">1</span>) note.addError(<span class="string">"number of seats must be positive"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>我决定从后向前来保证代码能够通过遗留测试，是重构过程中的重要原则。重构是一个特殊的技术，通过一系列行为来改变代码结构的同时保持代码原油的行为。所以当我们重构的时候，我们总是需要保持小步前进，以保持代码原有的行为。通过这样做，我们减少犯错机会，减少debug时间。</p>
<p>#<strong><em> 验证日期 </em></strong><br>对于日期的验证，我将从提取方法开始：<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> BookingRequest…</span><br><span class="line">  public Notification validation<span class="literal">()</span> &#123;</span><br><span class="line">    Notification note = <span class="keyword">new</span> <span class="constructor">Notification()</span>;</span><br><span class="line">*** validate<span class="constructor">Date(<span class="params">note</span>)</span>;</span><br><span class="line">    validate<span class="constructor">NumberOfSeats(<span class="params">note</span>)</span>;</span><br><span class="line">    return note;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">***<span class="keyword">private</span> void validate<span class="constructor">Date(Notification <span class="params">note</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (date<span class="operator"> == </span>null) throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"date is missing"</span>)</span>;</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedDate = <span class="module-access"><span class="module"><span class="identifier">LocalDate</span>.</span></span>parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"Invalid format for date"</span>, <span class="params">e</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.is<span class="constructor">Before(LocalDate.<span class="params">now</span>()</span>)) throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"date cannot be before today"</span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>现在我们可以开始从后向前验证日期了<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> BookingRequest…</span><br><span class="line">  <span class="keyword">private</span> void validate<span class="constructor">Date(Notification <span class="params">note</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (date<span class="operator"> == </span>null) throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"date is missing"</span>)</span>;</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedDate = <span class="module-access"><span class="module"><span class="identifier">LocalDate</span>.</span></span>parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"Invalid format for date"</span>, <span class="params">e</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">*** <span class="keyword">if</span> (parsedDate.is<span class="constructor">Before(LocalDate.<span class="params">now</span>()</span>)) note.add<span class="constructor">Error(<span class="string">"date cannot be before today"</span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>通过第二步，处理错误的过程有些复杂，由于抛出的异常中包含了引起它的异常。为了出了这个情况，我需要调整notification让它能够处理嵌套的异常(cause exception).由于我处于重构的中间步骤，我的代码还不能通过测试，所以我决定暂且将validateDate方法留在上述状态中，我将去丰富notification以使其支持嵌套的异常。</p>
<p>我开始修改notification，增加了一个以异常原因为参数的addError方法，并调整原有的方法使其适配。<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">Notification</span>…</span><br><span class="line">  <span class="symbol">public</span> <span class="symbol">void</span> <span class="symbol">addError</span>(<span class="symbol">String</span> <span class="symbol">message</span>) &#123;</span><br><span class="line">    addError(message, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">void</span> addError(String message, Exception e) &#123;</span><br><span class="line">    errors.add(message);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>这意味着我们接受嵌套异常，并把他忽略了。为了把cause异常纪录下来，我把error记录从一个简单的对象转变成了一个不那么简单的对象。<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Notification…</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="built_in">Error</span> &#123;</span><br><span class="line">    <span class="built_in">String</span> message;</span><br><span class="line">    Exception cause;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Error</span>(<span class="built_in">String</span> message, Exception cause) &#123;</span><br><span class="line">      <span class="keyword">this</span>.message = message;</span><br><span class="line">      <span class="keyword">this</span>.cause = cause;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>我通常不喜欢java中出现非private的域，但由于这是一个私有的内部类，我觉得也还行。如果我要把error类暴露出去，我会将这几个域包装一下。<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;Error&gt; errors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addError</span><span class="params">(<span class="keyword">String</span> message, Exception e)</span> </span>&#123;</span><br><span class="line">    errors.add(<span class="keyword">new</span> Error(message, e));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">errorMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> errors.stream()</span><br><span class="line">            .<span class="built_in">map</span>(e -&gt; e.message)</span><br><span class="line">            .collect(Collectors.joining(<span class="string">", "</span>));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>通过最新的notification，我可以开始改预定请求了。<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> BookingRequest…</span><br><span class="line">  <span class="keyword">private</span> void validate<span class="constructor">Date(Notification <span class="params">note</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (date<span class="operator"> == </span>null) throw <span class="keyword">new</span> <span class="constructor">IllegalArgumentException(<span class="string">"date is missing"</span>)</span>;</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedDate = <span class="module-access"><span class="module"><span class="identifier">LocalDate</span>.</span></span>parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      note.add<span class="constructor">Error(<span class="string">"Invalid format for date"</span>, <span class="params">e</span>)</span>;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.is<span class="constructor">Before(LocalDate.<span class="params">now</span>()</span>)) note.add<span class="constructor">Error(<span class="string">"date cannot be before today"</span>)</span>;</span><br></pre></td></tr></table></figure><br>由于我已经提取了方法，现在做起来就很容易了。<br>最后一步修改也很简单<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> BookingRequest…</span><br><span class="line">  <span class="keyword">private</span> void validate<span class="constructor">Date(Notification <span class="params">note</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (date<span class="operator"> == </span>null) &#123;</span><br><span class="line">      note.add<span class="constructor">Error(<span class="string">"date is missing"</span>)</span>;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    LocalDate parsedDate;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedDate = <span class="module-access"><span class="module"><span class="identifier">LocalDate</span>.</span></span>parse(date);</span><br><span class="line">    &#125;</span><br><span class="line">    catch (DateTimeParseException e) &#123;</span><br><span class="line">      note.add<span class="constructor">Error(<span class="string">"Invalid format for date"</span>, <span class="params">e</span>)</span>;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (parsedDate.is<span class="constructor">Before(LocalDate.<span class="params">now</span>()</span>)) note.add<span class="constructor">Error(<span class="string">"date cannot be before today"</span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>#<strong><em> 将工作栈上移 </em></strong><br>一旦我们有了新方法，下一个任务就是查看调用原来check方法的调用方，调整他们，使之可以使用心得validate方法。这意味着更广阔的视野来查看validation方法是否适合应用的流程，那么这就超出了本次重构的范畴。但是中期目标应该是当我们想验证是否失败时，将所有的异常移除。</p>
<p>许多情况下，本次重构将会完全避免继续使用check方法。所有的验证都应该直接调用validation方法。我们也应该同时调整测试来使用notification。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2015/06/18/Richard%E6%88%90%E7%86%9F%E5%BA%A6%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/06/18/Richard%E6%88%90%E7%86%9F%E5%BA%A6%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">Richard成熟度模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-06-18 00:00:00" itemprop="dateCreated datePublished" datetime="2015-06-18T00:00:00+08:00">2015-06-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">架构设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Leonard Richardson的模型将REST的基本元素分解到三个步骤当中。这三个步骤包括：资源（resources），http谓词（get, post, put, delete, head, option），超链接控制。</p>
<p>注：文章译自Martin Fowler博客,<a href="http://martinfowler.com/articles/richardsonMaturityModel.html" target="_blank" rel="noopener">原文链接</a>.<br>最近我（Martin Fowler）阅读了一本《Rest In Praces》，我的同事们写的一本书。他们的目的是解释如何使用Rest Web Service来解决企业级应用于道的集成难题。这本书的核心来自于一个观察，即当前的互联网（Web）就是一个大规模的分布式系统，并且它运行良好，所以我们可以借鉴互联网（Web）的组织方式来构建我们的集成系统。<br><img src="/images/1-layer-of-rest.png" alt="Figure 1: REST的层次"></p>
<p>为了更好的解释类互联网（web-style）系统的详细属性，（Rest In Practise）作者们使用了restfult成熟度模型（注：这一模型由Leonard Richardson发现，并在QCon上提出）。该模型采用了很好的方式来思考如何使用Web相关的技术。所以我（Martin Fowler）会以自己的方式来解释一下Rest成熟度模型（下面的例子只是用作说明，不值得拿去编码测试）。</p>
<p>#<strong><em> Level 0 </em></strong></p>
<p>起点是将HTTP作为远程交互的传输协议，而不使用Web相关的机制。实际上，这种方式只是讲HTTP座位一个通讯管道，而其中包含的是自定义的远程交互机制，通常是基于Remote Procedure Invocation。<br><img src="/images/2-interactive-of-layer0.png" alt="Figure 2: 使用Level 0的交互样例"></p>
<p>假设我要预约一下我的医生。我的预约软件首先需要知道，我的医生在特定日期哪个时段是可约的，所以它像医院的预约系统发送请求，以查看该信息。在Level 0的场景下，医院会在某个url上开放一个服务接入点（service endpoint）。我会向该接入点发送一个包含了我详细请求的文档。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /appointmentService HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line">&lt;openSlotRequest date = <span class="string">"2015-06-16"</span> <span class="attribute">doctor</span>=<span class="string">"mjones"</span>&gt;</span><br></pre></td></tr></table></figure><br>医院的服务器则会给我返回如下信息：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">openSlotList</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">slot</span> <span class="attr">start</span> = <span class="string">"14:00"</span>, <span class="attr">end</span> = <span class="string">"14:50"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">doctor</span> <span class="attr">id</span> = <span class="string">"mjones"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">slot</span> <span class="attr">start</span> = <span class="string">"16:00"</span>, <span class="attr">end</span> = <span class="string">"16:50"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">doctor</span> <span class="attr">id</span> = <span class="string">"mjones"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">openSlotList</span>&gt;</span></span><br></pre></td></tr></table></figure><br>我使用了XML座位例子，但这个内容可以是任何形式：JSON，YAML，key－Value Pairs，或是其他的自定义格式。<br>下面，我需要预约一个时段，同样的我可以想服务接入点发送一个请求。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /appointmentService HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointmentRequest</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">slot</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointmentRequest</span>&gt;</span></span><br></pre></td></tr></table></figure><br>如果一切顺利，我将会得到反馈说我的预约成功了。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">slot</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointment</span>&gt;</span></span><br></pre></td></tr></table></figure><br>如果遇到了问题，例如另一个人在我之前预约了，我将得到一个错误反馈。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointmentRequestFailure</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">slot</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span>=<span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">reason</span>&gt;</span>Slot not available<span class="tag">&lt;/<span class="name">reason</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointmentRequestFailure</span>&gt;</span></span><br></pre></td></tr></table></figure><br>到现在为止，仍是一个直观的RPC类系统。它只是在把XML发送与返回。如果你使用SOAP或者XML－RPC，基本与此类似，唯一的区别就是把你的XML信息包装在了一个“信封”中。</p>
<p>#<strong><em> Level 1 - Resources </em></strong></p>
<p>走向REST的在RMM中巅峰的第一步是引入资源（resources）。那么，现在与其将所有的请求都发往一个单独的服务接入点，我们现在可以想独立的资源发送请求了。<br><img src="/images/3-layer1-add-resources.png" alt="Figure 3: Level1 增加了资源（resource）"><br>那么对于我们的第一个请求，可能有一个资源代表指定的医生。<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">POST</span> /doctors/mjones HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;openSlotRequest date = "2015-06-16"&gt;</span></span><br></pre></td></tr></table></figure><br>响应携带类似的基本信息，但是每个slot都是一个可以被单独请求。<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line">&lt;openSlotList&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span>&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"5678"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"16:00"</span> <span class="attr">end</span> = <span class="string">"16:50"</span>&gt;</span><br><span class="line">&lt;openSlotList/&gt;</span><br></pre></td></tr></table></figure><br>有了对应的资源之后，预约一个时段意味着向对应的slot发送请求。<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">POST</span> /slots/1234 HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;appointmentRequest&gt;</span></span><br><span class="line">	<span class="section">&lt;patient id = "jsmith" /&gt;</span></span><br><span class="line"><span class="section">&lt;/appointmentRequest&gt;</span></span><br></pre></td></tr></table></figure><br>如果一起顺利，会得到一个类似下述的响应。<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line">&lt;appointment&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span> /&gt;</span><br><span class="line">	&lt;patient <span class="attr">id</span> = <span class="string">"jsmith"</span> /&gt;</span><br><span class="line">&lt;/appointment&gt;</span><br></pre></td></tr></table></figure><br>与Level0的差别是，如果有谁想对appointment做些什么，像预定一些化验，他们需要先拿到相应的appointment资源，该资源可能有个URI，像<a href="http://roylhope.nhs.uk/slots/1234/appointment，并对此URL发送请求。" target="_blank" rel="noopener">http://roylhope.nhs.uk/slots/1234/appointment，并对此URL发送请求。</a></p>
<p>对于像我这样的面相对象的人来说，资源特别像是对象的唯一标示符。相比于调用一个方法并传递（所有信息）参数，我们调用一个指定对象上的方法并提供其他相关的参数。</p>
<p>#<strong><em> Level 2 － HTTP Verbs </em></strong><br>在上述（Level0 和 Level1）的所有请求中，我都适用了HTTP的POST谓词，但是一些人会使用GET取而代之。在这些层面上（Level0和Level）并不会产生什么不同，他们都用来作为你在HTTP上传输交互信息的管道。Level2 比此更进了一步，使用HTTP的谓词来表征将会对响应的资源（resource）产生怎样的操作。<br><img src="/images/4-leve2-add-verbs.png" alt="Figure 4 Level 2 增加HTTP谓词语义"><br>对于我们想获得医生的空闲时段，意味着我们需要使用GET。<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/doctors/mjones/slots?date=20150616&amp;status=open</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: royalhope.nhs.uk</span><br></pre></td></tr></table></figure><br>得到的响应和使用POST一致。<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line">&lt;openSlotList&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span>&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"5678"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"16:00"</span> <span class="attr">end</span> = <span class="string">"16:50"</span>&gt;</span><br><span class="line">&lt;openSlotList/&gt;</span><br></pre></td></tr></table></figure><br>在Level2中，对于GET的使用是个关键。HTTP定义GET是一个安全操作，也就是说它不会对任何事物的状态引起任何特别的影响。这允许我们安全的任意次数的以任意顺序的执行GET，并得到相同的结果。一个重要的结果的是，它允许请求链路上的任何一个参与者使用缓存，而缓存恰恰是web性能的重要优化方式。HTTP包含多种方式支持缓存，这些可以被通讯中的所有参与者所使用。通过遵从HTTP的原则，我们能够利用它提供的能力。</p>
<p>为了预约一个时段，我们需要一个HTTP位次来改变（响应资源）状态，一个POST或是一个PUT。我会像之前一样使用POST。<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">POST</span> /slots/1234 HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;appointmentRequest&gt;</span></span><br><span class="line">	<span class="section">&lt;patient id = "jsmith" /&gt;</span></span><br><span class="line"><span class="section">&lt;/appointmentRequest&gt;</span></span><br></pre></td></tr></table></figure><br>POST和PUT之间的取舍超出了本文的范围，可能需要一篇新的文章来说明这个问题。但是我想指出一些人错误的映射了POST／PUT和CREATE／UPDATE之间的对应关系。他们之间的选择则是与这种映射关系更为不同。</p>
<p>尽管如果我使用了与Lelvel 1一样的POST请求，然而服务端的反馈则会有明显的不同。如果一切顺利，服务会返回一个带有201状态码的响应，201代表这有一个新的资源产生了。<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">201</span> Created</span><br><span class="line">Location: slots/<span class="number">1234</span>/appointment</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line">&lt;appointment&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span> /&gt;</span><br><span class="line">	&lt;patient <span class="attr">id</span> = <span class="string">"jsmith"</span> /&gt;</span><br><span class="line">&lt;/appointment&gt;</span><br></pre></td></tr></table></figure><br>201状态码表示了一个location参数，并携带了一个URI，该URI可以被客户端使用GET来查看资源状态。响应中也包含了新增资源的描述，可以引导客户端发送一个附加的请求。</p>
<p>当发生错误时还会产生另一种不同，例如某人已经预定了该时段。<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">409</span> <span class="keyword">Conflict</span></span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line">&lt;openSlotList&gt;</span><br><span class="line">	&lt;slot id = "5678" doctor = "mjones" start = "16:00" end = "16:50" /&gt;</span><br><span class="line">&lt;openSLotList&gt;</span><br></pre></td></tr></table></figure><br>这次响应中重要的部分是使用HTTP的状态码来表征发生了错误。在这种情况下，用409来表示其他人已经更新了该资源看起来是一个比较合适的选择。相比于返回一个状态码是200，但是内容中包含了错误信息，在Level 2中，我们显示的使用这种方式来表达错误的响应。具体使用什么状态码来表征什么反馈是协议设计者的事情，但是至少应该要采用一个非2XX的状态码来表征错误。Level 2 引入了HTTP的谓词和状态码。</p>
<p>这里有一个不一致的地方。REST建议使用所有的HTTP谓词。他们也在证实他们的方式是借鉴自Web系统的成功实践。但是万维网不怎么使用PUT和DELETE。有很多的理由来使用PUT和DELETE，但Web的经验并不是其中之一。</p>
<p>当前的Web最为重要的元素是强烈的区分开安全操作（GET）和非安全操作（POST），并且使用状态码来标示是否产生了错误。</p>
<p>#<strong><em> Level 3－Hypermedia Controls </em></strong><br>最后一个层次引入了大家耳熟能详的拥有丑陋缩写的HATEOAS(Hypertext As The Engine Of Application State)。它将问题从如何获取“空闲时段列表”转换成了要做什么才能预定到一个时段（抽象啊）。<br><img src="/images/5-leve3-add-hypertext.png" alt="Figure 5 ： Level 3 增加了超链接控制"><br>我们从最开始的GET请求入手，和在Level 2中发送的请求一样。<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/doctors/mjones/slots?date=20150616&amp;status=open</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: royalhope.nhs.uk</span><br></pre></td></tr></table></figure><br>但是响应中有一个新的元素：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line">&lt;openSlotList&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span>&gt;</span><br><span class="line">		&lt;link <span class="attr">rel</span> = <span class="string">"/linkrels/slot/book"</span> <span class="attr">uri</span> = <span class="string">"/slots/1234"</span> /&gt;</span><br><span class="line">	&lt;/slot&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"5678"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"16:00"</span> <span class="attr">end</span> = <span class="string">"16:50"</span>&gt;</span><br><span class="line">		&lt;link <span class="attr">rel</span> = <span class="string">"/linkrels/slot/book"</span> <span class="attr">uri</span> = <span class="string">"/slots/1234"</span> /&gt;</span><br><span class="line">	&lt;/slot&gt;</span><br><span class="line">&lt;openSlotList/&gt;</span><br></pre></td></tr></table></figure><br>每个slot中包含了一个link元素（包含个URI），用以表明可以怎样去预定一次预约。<br>超链接控制的关键点在于告诉我们下一步要做什么，以及下一步操作所需资源的URI。相对于要我们自己去了解要向哪里发送预约请求，超链接控制则是告诉我们怎么去做。</p>
<p>这个POST请求根Level 2中的一样。<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">POST</span> /slots/1234 HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;appointmentRequest&gt;</span></span><br><span class="line">	<span class="section">&lt;patient id = "jsmith" /&gt;</span></span><br><span class="line"><span class="section">&lt;/appointmentRequest&gt;</span></span><br></pre></td></tr></table></figure><br>而响应中则包含了一系列的超链接控制来表征下一步可以做的多个行为。<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">201</span> Created</span><br><span class="line">Location: slots/<span class="number">1234</span>/appointment</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line">&lt;appointment&gt;</span><br><span class="line">	&lt;slot <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"14:00"</span> <span class="attr">end</span> = <span class="string">"14:50"</span> /&gt;</span><br><span class="line">	&lt;patient <span class="attr">id</span> = <span class="string">"jsmith"</span> /&gt;</span><br><span class="line">	&lt;link <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/cancel"</span> <span class="attr">uri</span> = <span class="string">"/slots/1234/appointment"</span> /&gt;</span><br><span class="line">	&lt;link <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/addTest"</span> <span class="attr">uri</span> = <span class="string">"/slots/1234/appointment/tests"</span> /&gt;</span><br><span class="line">	&lt;link <span class="attr">rel</span> = <span class="string">"self"</span> <span class="attr">uri</span> = <span class="string">"/slots/1234/appointment"</span> /&gt;</span><br><span class="line">	&lt;link <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/changeTime"</span> <span class="attr">uri</span> = <span class="string">"/doctors/mjones/slots?date=20150616&amp;status=open"</span> /&gt;</span><br><span class="line">	&lt;link <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/updateContactInfo"</span> <span class="attr">uri</span> = <span class="string">"/patients/jsmith/contactInfo"</span> /&gt;</span><br><span class="line">	&lt;link <span class="attr">rel</span> = <span class="string">"/linkrels/help"</span> <span class="attr">uri</span> = <span class="string">"/help/appointment"</span> /&gt;</span><br><span class="line">&lt;/appointment&gt;</span><br></pre></td></tr></table></figure><br>超链接控制的一个显著好处是它允许服务端改变他自己的URI配置的同时不会对客户端引发影响。一旦用户寻找“addTest”的URI时，服务端可以隐藏掉所有其他的初始接入点。<br>一个附加的好处是允许客户端开发者了解整个协议。这些链接会给客户端开发者一个提示，“接下来你可能需要做什么”。他并不提供所有的信息，例如“latest”和“cancel”都指向相同的URI，他们需要明确一个是GET而另一个是DELETE。但是呐，这样至少给客户端开发人员一个出发点，让他们知道要去文档中找什么。<br>同样的，超链接控制允许服务端开发人员通过讲新的link加入响应的方式增加新功能。</p>
<p>到目前为止们还没有完整的标准来指导大家应该如何表征超链接控制。我当前所做的则是按照《REST in Practise》中推荐的那样（而他是遵从ATOM，RFC 4287的）。我使用<link>元素，其中包含uri属性（其标示了目标URI）以及rel属性（其标示出了关系的类型）。一个通用的关系（例如self用来指向资源本身）是十分明显的，任何其他特定于该服务端的link都是一个合格的URI。ATOM表明熟知的linkrels是<a href="http://www.iana.org/assignments/link-relations/link-relations.xhtml" target="_blank" rel="noopener">Registry Of Link Relations</a>。我写的这些受到ATOM限制的，ATOM本身是在第三层restfulness的领导者。</p>
<p>#<strong><em> 分层的意义 </em></strong><br>我应该强调的是，RMM，尽管它是一个思考REST相关元素的好方式，但并不是REST层次的定义本身。[Roy Fielding说明了3层RMM是REST的一个前置条件](<a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven]。像软件中的许多定义一样，REST有很多的定义，但是由于Roy" target="_blank" rel="noopener">http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven]。像软件中的许多定义一样，REST有很多的定义，但是由于Roy</a> Fielding发现了这一概念，他的定义应该比其他的更具权威性。<br>我发现，RMM提供了一个逐步递进的方式来帮助我们理解restful 这种想法背后的基本概念。因此，我把RMM视为一种帮助我们理解概念的工具而不是某种评价验证体系。我觉得使用Restful来集成系统的实际案例还不足以证实它是最好的。但是我确实认为它是一个吸引人的方案，并且在大多数情况下我会推荐这种方案。<br>与lan Robinson讨论，它强调RMM真正吸引人的地方在于它引入了普通的程序设计理念。</p>
<pre><code>* Level 1，通过讲一个大的服务接入点打碎成为许多的资源，来降低问题的复杂性。此处运用了分治的思想。
* Level 2，引入了一些列的标准谓词，所以我们可以用同样的方式来处理类似的问题。此处消除了不必要的变量。
* Level 3，引入了发现能力，提供了一种方式让协议可以自解释。此处引入了自解释能力。
</code></pre><p>本文译自Martin Fowler博客，<a href="http://martinfowler.com/articles/richardsonMaturityModel.html" target="_blank" rel="noopener">原文链接</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://coderfengyun.github.io/2015/06/01/Java%20Memory%20And%20GC%20Generation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderfengyun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/06/01/Java%20Memory%20And%20GC%20Generation/" class="post-title-link" itemprop="url">Java内存--GC分代</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2015-06-01T00:00:00+08:00">2015-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-07 16:33:16" itemprop="dateModified" datetime="2022-02-07T16:33:16+08:00">2022-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>作为Java程序员，很容易喜爱垃圾回收（garbage collection），无需自己释放内存。然而GC行为的基本内存模型是什么？其中，又有很多的概念，像young generation, old generation以及permanent generation，并且她们之间又回产生怎样的交互呢？</p>
<p>本文试图解决上述问题。下面将以最为浅显直接的图示来说明这几部分之间的关系。</p>
<p>#<strong><em> JVM内存组成 </em></strong></p>
<p>JVM内存由两部分组成: heap(堆空间)+ non-heap(非堆空间)</p>
<p>#<strong><em> Heap堆空间的组成 </em></strong></p>
<p>Heap堆空间分为young区和old区，其具体的组成结构关系如下图所示。<br><img src="/images/2-1_Heap空间的结构.png" alt="Figure1: Heap堆空间的结构"></p>
<p>从上图中，我们可以看出，Heap空间主要分为young区和old区，而其中young区由Eden Generation，Survivor Generation（多个）组成; 其中old区则由tenured generation组成。</p>
<p>并且，对象在这三个代中的流动时机也在图中有所表示。首先，当Eden Generation达到阈值，则会触发minor gc，如果对象依然有引用，则会被迁移到其中一个Survivor Generation中；如果对象在Survivor Generation中生存的时间足够长，则会被迁移到tenured generation中。</p>
<p><img src="/images/2-2_micor-major-full.jpg" alt="Figure2: minor gc, major gc, full gc"></p>
<p>未完待续…</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">coderfengyun</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">coderfengyun</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
